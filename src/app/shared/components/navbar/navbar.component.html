<nav class="app-navbar" aria-label="Barra de navegación principal">
  <div class="app-navbar__container">
    <a class="app-navbar__brand" routerLink="/" (click)="closeMenu()">
      <img
        class="app-navbar__brand-logo"
        src="assets/logos/logo.jpg"
        alt="Municipalidad Distrital de Echarati"
        width="320"
        height="96"
      />
      <span class="app-navbar__brand-copy">
        <span class="app-navbar__brand-name">Reportes Echarati</span>
        <span class="app-navbar__brand-tagline">Atención ciudadana municipal</span>
      </span>
    </a>

    <button
      class="app-navbar__toggle"
      type="button"
      (click)="toggleMenu()"
      [attr.aria-expanded]="menuOpen"
      aria-controls="appNavbarContent"
      aria-label="Mostrar u ocultar menú"
    >
      <span class="app-navbar__toggle-icon" aria-hidden="true"></span>
    </button>

    <div class="app-navbar__content" [class.is-open]="menuOpen" id="appNavbarContent">
      <ul class="app-navbar__links" role="menubar">
        <li *ngFor="let link of primaryLinks" role="none">
          <a
            class="app-navbar__link"
            [routerLink]="link.path"
            [fragment]="link.fragment"
            routerLinkActive="is-active"
            [routerLinkActiveOptions]="{ exact: link.exact !== false }"
            (click)="closeMenu()"
            role="menuitem"
          >
            <span class="app-navbar__link-label">{{ link.label }}</span>
            <span class="app-navbar__link-caret" aria-hidden="true"></span>
          </a>
        </li>
      </ul>

      <div class="app-navbar__actions">
        <button class="app-navbar__search" type="button" aria-label="Buscar en reportes">
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path
              d="M15.25 14h-.74l-.26-.25a5.5 5.5 0 10-.75.75l.25.26v.74l4.25 4.24a.75.75 0 101.06-1.06L15.25 14zM10.5 14a3.5 3.5 0 110-7 3.5 3.5 0 010 7z"
            />
          </svg>
        </button>

        <ng-container *ngIf="isLoggedIn(); else guestActions">
          <div class="app-navbar__profile">
            <button
              class="app-navbar__profile-trigger"
              type="button"
              (click)="toggleProfileMenu()"
              [attr.aria-expanded]="profileMenuOpen"
              aria-haspopup="menu"
              aria-controls="profileMenu"
            >
              <span class="app-navbar__avatar" aria-hidden="true">{{ userInitials }}</span>
              <span class="app-navbar__profile-copy">
                <span class="app-navbar__profile-name">{{ userLabel }}</span>
                <span class="app-navbar__profile-meta" *ngIf="currentUser?.email">
                  {{ currentUser?.email }}
                </span>
              </span>
              <span class="app-navbar__chevron" aria-hidden="true"></span>
            </button>

            <div class="app-navbar__dropdown" *ngIf="profileMenuOpen" id="profileMenu" role="menu">
              <button
                class="app-navbar__dropdown-item"
                type="button"
                role="menuitem"
                (click)="closeMenu()"
              >
                Mi perfil
              </button>
              <button
                class="app-navbar__dropdown-item"
                type="button"
                role="menuitem"
                (click)="closeMenu()"
              >
                Configuración
              </button>
              <hr class="app-navbar__dropdown-divider" />
              <button
                class="app-navbar__dropdown-item is-danger"
                type="button"
                role="menuitem"
                (click)="logout()"
              >
                Cerrar sesión
              </button>
            </div>
          </div>
        </ng-container>
        <ng-template #guestActions>
          <div class="app-navbar__guest">
            <a
              class="app-navbar__help"
              href="mailto:soporte&#64;echarati.gob.pe?subject=Solicitud de acceso"
            >
              Soporte
            </a>
            <button class="app-navbar__login" type="button" (click)="openLoginModal(); closeMenu()">
              Acceso
            </button>
          </div>
        </ng-template>
      </div>

      <app-login-modal
        *ngIf="showLoginModal"
        (close)="closeLoginModal()"
        [returnUrl]="loginReturnUrl"
        id="loginModal"
      ></app-login-modal>
    </div>
  </div>
</nav>
